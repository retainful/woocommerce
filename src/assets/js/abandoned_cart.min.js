"use strict";function initJqueryRetainfulAbandonedCartsTracking(){jQuery(function(t){var n=new(function(){function n(t,n){void 0===t&&(t=null),void 0===n&&(n=null),this.end_point=t,this.public_key=n,this.abandoned_cart_data=null,this.cart_token=null,this.cart_hash=null,this.cart_tracking_element_id="retainful-abandoned-cart-data",this.async_request=!0,this.previous_cart_hash=null}return n.prototype.setEndPoint=function(t){return this.end_point=t,this},n.prototype.getEndPoint=function(){return this.end_point},n.prototype.setPublicKey=function(t){return this.public_key=t,this},n.prototype.getPublicKey=function(){return this.public_key},n.prototype.setCartTrackingElementId=function(t){return this.cart_tracking_element_id=t,this},n.prototype.getCartTrackingElementId=function(){return this.cart_tracking_element_id},n.prototype.setAbandonedCartData=function(n){if(void 0===n&&(n=null),null!==n)this.abandoned_cart_data=n;else{var a=this.getCartTrackingElementId(),e=t("#"+a).html(),i=JSON.parse(e);if(this.abandoned_cart_data=void 0!==i.data?i.data:null,this.cart_hash=void 0!==i.cart_hash?i.cart_hash:null,this.cart_token=void 0!==i.cart_token?i.cart_token:null,this.isLocalStorageSupports()&&null!==this.cart_token){var r=localStorage.getItem("retainful_ac_cart_token_history"),o=localStorage.getItem("retainful_ac_cart_token"),l=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now();if(null===r){(s=[]).push({time:l,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(s))}else{var s=JSON.parse(r);o!==this.cart_token&&s.push({time:l,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(s))}localStorage.setItem("retainful_ac_cart_token",this.cart_token)}}return this},n.prototype.getAbandonedCartData=function(){return this.setAbandonedCartData(),this.abandoned_cart_data},n.prototype.getCartHash=function(){return this.cart_hash},n.prototype.initCartTracking=function(){var n=this;return t(document.body).on("added_to_cart removed_from_cart updated_cart_totals updated_shipping_method applied_coupon removed_coupon updated_checkout",function(){n.syncCart()}).on("wc_fragments_refreshed",function(){n.syncCart()}).on("wc_fragments_loaded",function(){n.syncCart()}),this},n.prototype.isLocalStorageSupports=function(){try{return sessionStorage.setItem("retainful","test"),sessionStorage.removeItem("retainful"),localStorage.setItem("retainful","test"),localStorage.removeItem("retainful"),!0}catch(t){return!1}},n.prototype.syncCart=function(t,n){void 0===t&&(t=null),void 0===n&&(n=!1),null===t&&(t=this.getAbandonedCartData());var a=this.getCartHash();if(null!=t&&""!==t&&a!==this.previous_cart_hash||n){this.previous_cart_hash=a;var e={app_id:this.getPublicKey(),"Content-Type":"application/json"},i={data:t};this.request(this.getEndPoint(),JSON.stringify(i),e,"json","POST",this.async_request)}},n.prototype.request=function(n,a,e,i,r,o){void 0===a&&(a={}),void 0===e&&(e={}),void 0===i&&(i="json"),void 0===r&&(r="POST"),void 0===o&&(o=!1);var l=null;return t.ajax({url:n,headers:e,method:r,dataType:i,data:a,async:o,success:function(t){l=t},error:function(t){l=t}}),l},n}())(retainful_cart_data.api_url,retainful_cart_data.public_key).setCartTrackingElementId(retainful_cart_data.tracking_element_selector);if("js"===retainful_cart_data.cart_tracking_engine&&n.initCartTracking(),void 0!==retainful_cart_data.cart){var a='<div id="'+retainful_cart_data.tracking_element_selector+'" style="display:none;">'+JSON.stringify(retainful_cart_data.cart)+"</div>";t(a).appendTo("body")}t("input#billing_email,input#billing_last_name,input#billing_first_name,input#billing_postcode,select#billing_country,select#billing_state").on("change",function(){if(""!==t("#billing_email").val()){var a=t("#ship-to-different-address-checkbox:checked").length,e={billing_first_name:t("#billing_first_name").val(),billing_last_name:t("#billing_last_name").val(),billing_company:t("#billing_company").val(),billing_address_1:t("#billing_address_1").val(),billing_address_2:t("#billing_address_2").val(),billing_city:t("#billing_city").val(),billing_state:t("#billing_state").val(),billing_postcode:t("#billing_postcode").val(),billing_country:t("#billing_country").val(),billing_phone:t("#billing_phone").val(),billing_email:t("#billing_email").val(),ship_to_billing:a,order_notes:t("#order_comments").val(),shipping_first_name:t("#shipping_first_name").val(),shipping_last_name:t("#shipping_last_name").val(),shipping_company:t("#shipping_company").val(),shipping_address_1:t("#shipping_address_1").val(),shipping_address_2:t("#shipping_address_2").val(),shipping_city:t("#shipping_city").val(),shipping_state:t("#shipping_state").val(),shipping_postcode:t("#shipping_postcode").val(),shipping_country:t("#shipping_country").val(),action:"rnoc_track_user_data"},i=n.request(retainful_cart_data.ajax_url,e,{},"json","POST",!1);i.success&&i.data&&n.syncCart(i.data,!0)}})})}document.addEventListener("DOMContentLoaded",function(){if("undefined"==typeof jQuery){var t="https://code.jquery.com/jquery-3.2.1.min.js";void 0!==retainful_cart_data.jquery_url&&(t=retainful_cart_data.jquery_url),function(t,n){var a=document.createElement("script");a.src=t;var e=document.getElementsByTagName("head")[0],i=!1;a.onload=a.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,n(),a.onload=a.onreadystatechange=null,e.removeChild(a))},e.appendChild(a)}(t,function(){"undefined"==typeof jQuery?console.log("retainful unable to include jQuery"):(jQuery.noConflict(),initJqueryRetainfulAbandonedCartsTracking())})}else initJqueryRetainfulAbandonedCartsTracking()});