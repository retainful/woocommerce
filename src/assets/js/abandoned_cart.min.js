"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function initJqueryRetainfulAbandonedCartsTracking(t){jQuery(function(e){var n=new(function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.ajax_url=null,this.is_force_synced=!1,this.end_point=t,this.public_key=e,this.abandoned_cart_data=null,this.cart_token=null,this.ip=null,this.version=null,this.cart_hash=null,this.force_refresh_carts=null,this.cart_tracking_element_id="retainful-abandoned-cart-data",this.async_request=!0,this.previous_cart_hash=null}return t.prototype.setIp=function(t){return void 0===t&&(t=null),this.ip=t,this},t.prototype.setVersion=function(t){return void 0===t&&(t=null),this.version=t,this},t.prototype.setEndPoint=function(t){return this.end_point=t,this},t.prototype.getEndPoint=function(){return this.end_point},t.prototype.setPublicKey=function(t){return this.public_key=t,this},t.prototype.getPublicKey=function(){return this.public_key},t.prototype.getIp=function(){return this.ip},t.prototype.getVersion=function(){return this.version},t.prototype.setCartTrackingElementId=function(t){return this.cart_tracking_element_id=t,this},t.prototype.setAjaxUrl=function(t){return this.ajax_url=t,this},t.prototype.getCartTrackingElementId=function(){return this.cart_tracking_element_id},t.prototype.setAbandonedCartData=function(t){if(void 0===t&&(t=null),null!==t)this.abandoned_cart_data=t;else{var n=this.getCartTrackingElementId(),i=e("#"+n).html(),a=JSON.parse(i);if(this.abandoned_cart_data=void 0!==a.data?a.data:null,this.cart_hash=void 0!==a.cart_hash?a.cart_hash:null,this.cart_token=void 0!==a.cart_token?a.cart_token:null,this.force_refresh_carts=void 0!==a.force_refresh_carts?a.force_refresh_carts:null,this.isLocalStorageSupports()&&null!==this.cart_token){var r=localStorage.getItem("retainful_ac_cart_token_history"),o=localStorage.getItem("retainful_ac_cart_token"),s=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now();if(null===r){(l=[]).push({time:s,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(l))}else{var l=JSON.parse(r);o!==this.cart_token&&l.push({time:s,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(l))}localStorage.setItem("retainful_ac_cart_token",this.cart_token)}}return this},t.prototype.getAbandonedCartData=function(){return this.setAbandonedCartData(),this.abandoned_cart_data},t.prototype.getCartHash=function(){return this.cart_hash},t.prototype.getCartToken=function(){var t=localStorage.getItem("retainful_ac_cart_token");return null===t&&""===t||this.setCartToken(t),this.cart_token},t.prototype.setCartToken=function(t){this.cart_token=t},t.prototype.initCartTracking=function(){var t=this;return e(document.body).on("added_to_cart removed_from_cart updated_cart_totals updated_shipping_method applied_coupon removed_coupon updated_checkout",function(){t.syncCart()}).on("wc_fragments_refreshed",function(){t.syncCart()}).on("wc_fragments_loaded",function(){t.syncCart()}),this},t.prototype.isLocalStorageSupports=function(){try{return sessionStorage.setItem("retainful","test"),sessionStorage.removeItem("retainful"),localStorage.setItem("retainful","test"),localStorage.removeItem("retainful"),!0}catch(t){return!1}},t.prototype.syncCart=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!1),null===t&&(t=this.getAbandonedCartData());var i=this.getCartHash();if(null!=t&&""!==t&&i!==this.previous_cart_hash||e){this.previous_cart_hash=i;var a={app_id:this.getPublicKey(),"Content-Type":"application/json","X-Client-Referrer-IP":this.getIp(),"X-Retainful-Version":this.getVersion(),"X-Cart-Token":this.getCartToken(),"Cart-Token":this.getCartToken()},r={data:t};this.request(this.getEndPoint(),JSON.stringify(r),a,"json","POST",this.async_request)}if(null!==this.force_refresh_carts&&!this.is_force_synced){this.is_force_synced=!0;var o=n.request(this.ajax_url,{action:"rnoc_track_user_data"},{},"json","POST",!1);o.success&&o.data&&n.syncCart(o.data,!0)}},t.prototype.request=function(t,n,i,a,r,o){void 0===n&&(n={}),void 0===i&&(i={}),void 0===a&&(a="json"),void 0===r&&(r="POST"),void 0===o&&(o=!1);var s=null;return e.ajax({url:t,headers:i,method:r,dataType:a,data:n,async:o,success:function(t){s=t},error:function(t){s=t}}),s},t.prototype.validateEmail=function(t){var e=!0;if(-1===t.indexOf("@"))e=!1;else{var n=t.split("@")[1];if(-1===n.indexOf("."))e=!1;else{var i=n.split(".")[1];(i.length>14||i.length<2)&&(e=!1)}}return e},t}())(t.api_url,t.public_key).setCartTrackingElementId(t.tracking_element_selector);if("js"===t.cart_tracking_engine&&(n.setAjaxUrl(t.ajax_url),n.setIp(t.ip),n.setVersion(t.version),n.initCartTracking(),e(document).ready(function(){n.syncCart()})),void 0!==t.cart){var i='<div id="'+t.tracking_element_selector+'" style="display:none;">'+JSON.stringify(t.cart)+"</div>";e(i).appendTo("body")}function a(i,a,r){if(void 0!==i){var o=i.indexOf("@"),s=i.lastIndexOf(".");null==a&&(a=""),(!(o<1||s<o+2||s+2>=i.length)||a.length>=1)&&(Object.keys(r).forEach(function(t){return void 0===r[t]&&delete r[t]}),n.validateEmail(i)||a.length>=4?(sessionStorage.setItem("rnocp_is_add_to_cart_popup_email_entered","1"),e.ajax({url:t.ajax_url,headers:{},method:"POST",dataType:"json",data:r,async:!0,success:function(t){t.success&&t.data&&n.syncCart(t.data,!0)},error:function(t){t}})):sessionStorage.setItem("rnocp_is_add_to_cart_popup_email_entered","0"))}}e("input#billing_email,input#billing_first_name,input#billing_last_name,input#billing_phone").on("change",function(){var t=e("#billing_phone").val(),n=e("#billing_email").val(),i=e("#ship-to-different-address-checkbox:checked").length;a(n,t,{billing_first_name:e("#billing_first_name").val(),billing_last_name:e("#billing_last_name").val(),billing_company:e("#billing_company").val(),billing_address_1:e("#billing_address_1").val(),billing_address_2:e("#billing_address_2").val(),billing_city:e("#billing_city").val(),billing_state:e("#billing_state").val(),billing_postcode:e("#billing_postcode").val(),billing_country:e("#billing_country").val(),billing_phone:e("#billing_phone").val(),billing_email:e("#billing_email").val(),ship_to_billing:i,order_notes:e("#order_comments").val(),shipping_first_name:e("#shipping_first_name").val(),shipping_last_name:e("#shipping_last_name").val(),shipping_company:e("#shipping_company").val(),shipping_address_1:e("#shipping_address_1").val(),shipping_address_2:e("#shipping_address_2").val(),shipping_city:e("#shipping_city").val(),shipping_state:e("#shipping_state").val(),shipping_postcode:e("#shipping_postcode").val(),shipping_country:e("#shipping_country").val(),action:"rnoc_track_user_data"})}),e(".wp-block-woocommerce-checkout input#email,.wp-block-woocommerce-checkout input#phone").on("change",function(){var t=e(".wp-block-woocommerce-checkout input#email").val(),n=e(".wp-block-woocommerce-checkout input#phone").val();a(t,n,{billing_first_name:e(".wp-block-woocommerce-checkout #billing-first_name").val(),billing_last_name:e(".wp-block-woocommerce-checkout #billing-last_name").val(),billing_address_1:e(".wp-block-woocommerce-checkout #billing-address_1").val(),billing_address_2:e(".wp-block-woocommerce-checkout #billing-address_2").val(),billing_city:e(".wp-block-woocommerce-checkout #billing-city").val(),billing_postcode:e(".wp-block-woocommerce-checkout #billing-postcode").val(),billing_phone:n,billing_email:t,ship_to_billing:1,action:"rnoc_track_user_data"})})})}document.addEventListener("DOMContentLoaded",function(){var t={ajax_url:"",jquery_url:"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js",ip:"",version:"",public_key:"",api_url:"",tracking_element_selector:"retainful-abandoned-cart-data",cart_tracking_engine:"js"},e={};if(e="undefined"==typeof retainful_cart_data?__assign(__assign({},t),{}):__assign(__assign({},t),retainful_cart_data),"undefined"==typeof jQuery){!function(t,e){var n=document.createElement("script");n.src=t;var i=document.getElementsByTagName("head")[0],a=!1;n.onload=n.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,e(),n.onload=n.onreadystatechange=null,i.removeChild(n))},i.appendChild(n)}(e.jquery_url,function(){"undefined"==typeof jQuery?console.log("retainful unable to include jQuery"):(jQuery.noConflict(),initJqueryRetainfulAbandonedCartsTracking(e))})}else initJqueryRetainfulAbandonedCartsTracking(e)});