"use strict";function initJqueryRetainfulAbandonedCartsTracking(){jQuery(function(t){var e=new(function(){function n(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.ajax_url=null,this.is_force_synced=!1,this.end_point=t,this.public_key=e,this.abandoned_cart_data=null,this.cart_token=null,this.ip=null,this.version=null,this.cart_hash=null,this.force_refresh_carts=null,this.cart_tracking_element_id="retainful-abandoned-cart-data",this.async_request=!0,this.previous_cart_hash=null}return n.prototype.setIp=function(t){return void 0===t&&(t=null),this.ip=t,this},n.prototype.setVersion=function(t){return void 0===t&&(t=null),this.version=t,this},n.prototype.setEndPoint=function(t){return this.end_point=t,this},n.prototype.getEndPoint=function(){return this.end_point},n.prototype.setPublicKey=function(t){return this.public_key=t,this},n.prototype.getPublicKey=function(){return this.public_key},n.prototype.getIp=function(){return this.ip},n.prototype.getVersion=function(){return this.version},n.prototype.setCartTrackingElementId=function(t){return this.cart_tracking_element_id=t,this},n.prototype.setAjaxUrl=function(t){return this.ajax_url=t,this},n.prototype.getCartTrackingElementId=function(){return this.cart_tracking_element_id},n.prototype.setAbandonedCartData=function(e){if(void 0===e&&(e=null),null!==e)this.abandoned_cart_data=e;else{var n=this.getCartTrackingElementId(),a=t("#"+n).html(),i=JSON.parse(a);if(this.abandoned_cart_data=void 0!==i.data?i.data:null,this.cart_hash=void 0!==i.cart_hash?i.cart_hash:null,this.cart_token=void 0!==i.cart_token?i.cart_token:null,this.force_refresh_carts=void 0!==i.force_refresh_carts?i.force_refresh_carts:null,this.isLocalStorageSupports()&&null!==this.cart_token){var r=localStorage.getItem("retainful_ac_cart_token_history"),o=localStorage.getItem("retainful_ac_cart_token"),s=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now();if(null===r){(l=[]).push({time:s,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(l))}else{var l=JSON.parse(r);o!==this.cart_token&&l.push({time:s,token:this.cart_token}),localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(l))}localStorage.setItem("retainful_ac_cart_token",this.cart_token)}}return this},n.prototype.getAbandonedCartData=function(){return this.setAbandonedCartData(),this.abandoned_cart_data},n.prototype.getCartHash=function(){return this.cart_hash},n.prototype.getCartToken=function(){var t=localStorage.getItem("retainful_ac_cart_token");return null===t&&""===t||this.setCartToken(t),this.cart_token},n.prototype.setCartToken=function(t){this.cart_token=t},n.prototype.initCartTracking=function(){var e=this;return t(document.body).on("added_to_cart removed_from_cart updated_cart_totals updated_shipping_method applied_coupon removed_coupon updated_checkout",function(){e.syncCart()}).on("wc_fragments_refreshed",function(){e.syncCart()}).on("wc_fragments_loaded",function(){e.syncCart()}),this},n.prototype.isLocalStorageSupports=function(){try{return sessionStorage.setItem("retainful","test"),sessionStorage.removeItem("retainful"),localStorage.setItem("retainful","test"),localStorage.removeItem("retainful"),!0}catch(t){return!1}},n.prototype.syncCart=function(t,n){void 0===t&&(t=null),void 0===n&&(n=!1),null===t&&(t=this.getAbandonedCartData());var a=this.getCartHash();if(null!=t&&""!==t&&a!==this.previous_cart_hash||n){this.previous_cart_hash=a;var i={app_id:this.getPublicKey(),"Content-Type":"application/json","X-Client-Referrer-IP":this.getIp(),"X-Retainful-Version":this.getVersion(),"X-Cart-Token":this.getCartToken(),"Cart-Token":this.getCartToken()},r={data:t};this.request(this.getEndPoint(),JSON.stringify(r),i,"json","POST",this.async_request)}if(null!==this.force_refresh_carts&&!this.is_force_synced){this.is_force_synced=!0;var o=e.request(this.ajax_url,{action:"rnoc_track_user_data"},{},"json","POST",!1);o.success&&o.data&&e.syncCart(o.data,!0)}},n.prototype.request=function(e,n,a,i,r,o){void 0===n&&(n={}),void 0===a&&(a={}),void 0===i&&(i="json"),void 0===r&&(r="POST"),void 0===o&&(o=!1);var s=null;return t.ajax({url:e,headers:a,method:r,dataType:i,data:n,async:o,success:function(t){s=t},error:function(t){s=t}}),s},n}())(retainful_cart_data.api_url,retainful_cart_data.public_key).setCartTrackingElementId(retainful_cart_data.tracking_element_selector);if("js"===retainful_cart_data.cart_tracking_engine&&(e.setAjaxUrl(retainful_cart_data.ajax_url),e.setIp(retainful_cart_data.ip),e.setVersion(retainful_cart_data.version),e.initCartTracking(),t(document).ready(function(){e.syncCart()})),void 0!==retainful_cart_data.cart){var n='<div id="'+retainful_cart_data.tracking_element_selector+'" style="display:none;">'+JSON.stringify(retainful_cart_data.cart)+"</div>";t(n).appendTo("body")}t("input#billing_email,input#billing_last_name,input#billing_first_name,input#billing_postcode,select#billing_country,select#billing_state").on("change",function(){if(""!==t("#billing_email").val()){var n=t("#ship-to-different-address-checkbox:checked").length,a={billing_first_name:t("#billing_first_name").val(),billing_last_name:t("#billing_last_name").val(),billing_company:t("#billing_company").val(),billing_address_1:t("#billing_address_1").val(),billing_address_2:t("#billing_address_2").val(),billing_city:t("#billing_city").val(),billing_state:t("#billing_state").val(),billing_postcode:t("#billing_postcode").val(),billing_country:t("#billing_country").val(),billing_phone:t("#billing_phone").val(),billing_email:t("#billing_email").val(),ship_to_billing:n,order_notes:t("#order_comments").val(),shipping_first_name:t("#shipping_first_name").val(),shipping_last_name:t("#shipping_last_name").val(),shipping_company:t("#shipping_company").val(),shipping_address_1:t("#shipping_address_1").val(),shipping_address_2:t("#shipping_address_2").val(),shipping_city:t("#shipping_city").val(),shipping_state:t("#shipping_state").val(),shipping_postcode:t("#shipping_postcode").val(),shipping_country:t("#shipping_country").val(),action:"rnoc_track_user_data"},i=e.request(retainful_cart_data.ajax_url,a,{},"json","POST",!1);i.success&&i.data&&e.syncCart(i.data,!0)}})})}document.addEventListener("DOMContentLoaded",function(){if("undefined"==typeof jQuery){var t="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js";void 0!==retainful_cart_data.jquery_url&&(t=retainful_cart_data.jquery_url),function(t,e){var n=document.createElement("script");n.src=t;var a=document.getElementsByTagName("head")[0],i=!1;n.onload=n.onreadystatechange=function(){i||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i=!0,e(),n.onload=n.onreadystatechange=null,a.removeChild(n))},a.appendChild(n)}(t,function(){"undefined"==typeof jQuery?console.log("retainful unable to include jQuery"):(jQuery.noConflict(),initJqueryRetainfulAbandonedCartsTracking())})}else initJqueryRetainfulAbandonedCartsTracking()});