"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var o,e=1,a=arguments.length;e<a;e++)for(var n in o=arguments[e])Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}).apply(this,arguments)};if("undefined"==typeof jQuery){function getScript(t,o){var e=document.createElement("script");e.src=t;var a=document.getElementsByTagName("head")[0],n=!1;e.onload=e.onreadystatechange=function(){n||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n=!0,o(),e.onload=e.onreadystatechange=null,a.removeChild(e))},a.appendChild(e)}void 0!==retainful_premium_add_to_cart_collection_popup_condition.jquery_url&&getScript(retainful_premium_add_to_cart_collection_popup_condition.jquery_url,function(){"undefined"==typeof jQuery||(jQuery.noConflict(),initJqueryRetainfulPopupJs())})}else initJqueryRetainfulPopupJs();function initJqueryRetainfulPopupJs(){jQuery(function(t){var o=(new(function(){function o(){this.add_to_cart_popup_options={}}return o.prototype.isLocalStorageSupports=function(){try{return sessionStorage.setItem("retainful","test"),sessionStorage.removeItem("retainful"),localStorage.setItem("retainful","test"),localStorage.removeItem("retainful"),!0}catch(t){return!1}},o.prototype.setOptions=function(t){void 0===t&&(t={});return this.add_to_cart_popup_default_options=__assign(__assign({},{enable_add_to_cart_popup:"no",is_email_mandatory:"yes",no_thanks_action:"1",show_popup_until:"1",add_to_cart_popup_base_id:"#rnoc-add-to-cart-add-on"}),t),this},o.prototype.getOptions=function(){return this.add_to_cart_popup_default_options},o.prototype.displayPopup=function(o){t(document).trigger("retainful_showing_add_to_cart_popup",[o]),o.removeClass("loading"),o.addClass("rnoc-popup-opener");var e=this.getAddToCartPopupWindow();e.css("display","block"),localStorage.setItem("retainful_add_to_cart_opened","yes"),t(document).trigger("retainful_showed_add_to_cart_popup",[e,o])},o.prototype.closePopup=function(o){if(void 0===o&&(o="1"),this.isLocalStorageSupports()){localStorage.setItem("retainful_add_to_cart_popup_closed_by",o);var e=this.getAddToCartPopupWindow();t(document).trigger("retainful_closing_add_to_cart_popup",[e]);var a=t(".rnoc-popup-opener");"3"!==o&&("2"===o&&localStorage.setItem("retainful_add_to_cart_popup_temporary_silent","1"),a.click()),a.removeClass("rnoc-popup-opener"),e.css("display","none"),t(document).trigger("retainful_closed_add_to_cart_popup",[e])}},o.prototype.getAddToCartPopupWindow=function(){var o=this.getOptions();return t(o.add_to_cart_popup_base_id)},o.prototype.isPopupEnabled=function(){return"yes"===this.getOptions().enable_add_to_cart_popup},o.prototype.isEmail=function(t){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)},o.prototype.needPopup=function(){var t=this.getOptions();if(this.isLocalStorageSupports()&&this.isPopupEnabled()){if("1"===localStorage.getItem("retainful_add_to_cart_popup_temporary_silent"))return localStorage.removeItem("retainful_add_to_cart_popup_temporary_silent"),!1;var o=localStorage.getItem("retainful_add_to_cart_popup_closed_by");if(null===o)return!0;var e=!0;switch(t.show_popup_until){default:case"1":e="1"!==o;break;case"2":e="2"!==o,"1"===t.no_thanks_action&&(e=!1);break;case"3":e="3"!==o}return e}return!1},o.prototype.syncEmail=function(t,o,e,a,n){a.preventDefault(),n.hide();var r=this.getOptions();if("yes"!==r.is_email_mandatory)return this.closePopup("1"),{error:!1};if("yes"===r.is_email_mandatory&&""===t)return n.show(),{error:!0};if("yes"===r.is_email_mandatory&&!this.isEmail(t))return n.show(),{error:!0};if("yes"===r.is_email_mandatory&&this.isEmail(t)){e.addClass("loading"),e.attr("disabled",!0);var i={email:t,is_buyer_accepting_marketing:o.is(":checked")?1:0,action:"set_rnoc_guest_session"},p=this.request(rnoc_ajax_url,i);return p.error?p.message:(p.message,p.show_coupon_instant_popup&&(sessionStorage.setItem("rnoc_instant_coupon_popup_showed","no"),sessionStorage.setItem("rnoc_instant_coupon_popup_html",p.coupon_instant_popup_content)),this.closePopup("1")),e.removeClass("loading"),e.attr("disabled",!1),{error:!1}}},o.prototype.request=function(o,e,a,n,r,i){void 0===e&&(e={}),void 0===a&&(a={}),void 0===n&&(n="json"),void 0===r&&(r="POST"),void 0===i&&(i=!1);var p=null;return t.ajax({url:o,headers:a,method:r,dataType:n,data:e,async:i,success:function(t){p=t},error:function(t){p=t}}),p},o}())).setOptions(retainful_premium_add_to_cart_collection_popup_condition);if(t(document).on("adding_to_cart",function(t,e){if(o.needPopup())throw o.displayPopup(e),new Error("Retainful intercepts to show popup!")}),t(document).on("click","#rnoc-add-to-cart-add-on .close-rnoc-popup",function(){o.closePopup("3")}),t(document).on("click","#rnoc-add-to-cart-add-on .no-thanks-close-popup",function(){o.closePopup("2")}),t(document).on("click","#rnoc-add-to-cart-add-on .rnoc-popup-btn",function(e){var a=t("#rnoc-add-to-cart-add-on #rnoc-popup-email-field").val(),n=t("#rnoc-add-to-cart-add-on  #rnoc-invalid-mail-message"),r=t("#rnoc-add-to-cart-add-on #rnoc-popup-buyer-accepts-marketing");o.syncEmail(a,r,t("#rnoc-add-to-cart-add-on .rnoc-popup-btn"),e,n)}),t(document).on("click",".single_add_to_cart_button,[name=add-to-cart]",function(e){o.needPopup()&&(e.preventDefault(),o.displayPopup(t(this)))}),"undefined"!=typeof retainful_premium_add_to_cart_collection&&void 0!==retainful_premium_add_to_cart_collection.add_to_cart_button_classes){var e=retainful_premium_add_to_cart_collection.add_to_cart_button_classes;t(document).on("click",e,function(e){var a=t(this),n=a.attr("href"),r=a.attr("name");void 0!==n&&o.needPopup()&&-1!==n.indexOf("add-to-cart")?(e.preventDefault(),o.displayPopup(a)):void 0!==r&&"add-to-cart"===r&&(e.preventDefault(),o.displayPopup(a))})}})}