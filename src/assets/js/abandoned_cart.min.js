"use strict";var __assign=(this&&this.__assign)||function(){__assign=Object.assign||function(b){for(var c,a=1,e=arguments.length;a<e;a++){c=arguments[a];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){b[d]=c[d]}}}return b};return __assign.apply(this,arguments)};document.addEventListener("DOMContentLoaded",function(){var c={ajax_url:"",jquery_url:"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js",ip:"",version:"",public_key:"",api_url:"",tracking_element_selector:"retainful-abandoned-cart-data",cart_tracking_engine:"js",};var b={};if(typeof retainful_cart_data==="undefined"){b=__assign(__assign({},c),{})}else{b=__assign(__assign({},c),retainful_cart_data)}if(typeof jQuery=="undefined"){function a(f,h){var e=document.createElement("script");e.src=f;var g=document.getElementsByTagName("head")[0],d=false;e.onload=e.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;h();e.onload=e.onreadystatechange=null;g.removeChild(e)}};g.appendChild(e)}a(b.jquery_url,function(){if(typeof jQuery=="undefined"){console.log("retainful unable to include jQuery")}else{jQuery.noConflict();initJqueryRetainfulAbandonedCartsTracking(b)}})}else{initJqueryRetainfulAbandonedCartsTracking(b)}});function initJqueryRetainfulAbandonedCartsTracking(a){jQuery(function(f){var d=(function(){function g(h,i){if(h===void 0){h=null}if(i===void 0){i=null}this.ajax_url=null;this.is_force_synced=false;this.end_point=h;this.public_key=i;this.abandoned_cart_data=null;this.cart_token=null;this.ip=null;this.version=null;this.cart_hash=null;this.force_refresh_carts=null;this.cart_tracking_element_id="retainful-abandoned-cart-data";this.async_request=true;this.previous_cart_hash=null}g.prototype.setIp=function(h){if(h===undefined){h=null}this.ip=h;return this};g.prototype.setVersion=function(h){if(h===undefined){h=null}this.version=h;return this};g.prototype.setEndPoint=function(h){this.end_point=h;return this};g.prototype.getEndPoint=function(){return this.end_point};g.prototype.setPublicKey=function(h){this.public_key=h;return this};g.prototype.getPublicKey=function(){return this.public_key};g.prototype.getIp=function(){return this.ip};g.prototype.getVersion=function(){return this.version};g.prototype.setCartTrackingElementId=function(h){this.cart_tracking_element_id=h;return this};g.prototype.setAjaxUrl=function(h){this.ajax_url=h;return this};g.prototype.getCartTrackingElementId=function(){return this.cart_tracking_element_id};g.prototype.setAbandonedCartData=function(i){if(i===void 0){i=null}if(i!==null){this.abandoned_cart_data=i}else{var l=this.getCartTrackingElementId();var n=f("#"+l).html();var o=JSON.parse(n);this.abandoned_cart_data=(o.data!==undefined)?o.data:null;this.cart_hash=(o.cart_hash!==undefined)?o.cart_hash:null;this.cart_token=(o.cart_token!==undefined)?o.cart_token:null;this.force_refresh_carts=(o.force_refresh_carts!==undefined)?o.force_refresh_carts:null;if(this.isLocalStorageSupports()&&this.cart_token!==null){var k=localStorage.getItem("retainful_ac_cart_token_history");var m=localStorage.getItem("retainful_ac_cart_token");var h=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now();if(k===null){var j=[];j.push({time:h,token:this.cart_token});localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(j))}else{var j=JSON.parse(k);if(m!==this.cart_token){j.push({time:h,token:this.cart_token})}localStorage.setItem("retainful_ac_cart_token_history",JSON.stringify(j))}localStorage.setItem("retainful_ac_cart_token",this.cart_token)}}return this};g.prototype.getAbandonedCartData=function(){this.setAbandonedCartData();return this.abandoned_cart_data};g.prototype.getCartHash=function(){return this.cart_hash};g.prototype.getCartToken=function(){var h=localStorage.getItem("retainful_ac_cart_token");if(h!==null||h!==""){this.setCartToken(h)}return this.cart_token};g.prototype.setCartToken=function(h){this.cart_token=h};g.prototype.initCartTracking=function(){var h=this;f(document.body).on("added_to_cart removed_from_cart updated_cart_totals updated_shipping_method applied_coupon removed_coupon updated_checkout",function(){h.syncCart()}).on("wc_fragments_refreshed",function(){h.syncCart()}).on("wc_fragments_loaded",function(){h.syncCart()});return this};g.prototype.isLocalStorageSupports=function(){try{sessionStorage.setItem("retainful","test");sessionStorage.removeItem("retainful");localStorage.setItem("retainful","test");localStorage.removeItem("retainful");return true}catch(h){return false}};g.prototype.syncCart=function(i,l){if(i===void 0){i=null}if(l===void 0){l=false}if(i===null){i=this.getAbandonedCartData()}var j=this.getCartHash();if((i!==undefined&&i!==null&&i!==""&&j!==this.previous_cart_hash)||(l)){this.previous_cart_hash=j;var m={app_id:this.getPublicKey(),"Content-Type":"application/json","X-Client-Referrer-IP":this.getIp(),"X-Retainful-Version":this.getVersion(),"X-Cart-Token":this.getCartToken(),"Cart-Token":this.getCartToken()};var h={data:i};this.request(this.getEndPoint(),JSON.stringify(h),m,"json","POST",this.async_request)}if(this.force_refresh_carts!==null&&!this.is_force_synced){this.is_force_synced=true;var k=c.request(this.ajax_url,{action:"rnoc_track_user_data"},{},"json","POST",false);if(k.success&&k.data){c.syncCart(k.data,true)}}};g.prototype.request=function(i,h,m,l,n,j){if(h===void 0){h={}}if(m===void 0){m={}}if(l===void 0){l="json"}if(n===void 0){n="POST"}if(j===void 0){j=false}var k=null;f.ajax({url:i,headers:m,method:n,dataType:l,data:h,async:j,success:function(o){k=o},error:function(o){k=o}});return k};g.prototype.validateEmail=function(k){var i=true;if(k.indexOf("@")===-1){i=false}else{var l=k.split("@");var j=l[1];if(j.indexOf(".")===-1){i=false}else{var m=j.split(".");var h=m[1];if(h.length>14||h.length<2){i=false}}}return i};return g}());var c=new d(a.api_url,a.public_key).setCartTrackingElementId(a.tracking_element_selector);if(a.cart_tracking_engine==="js"){c.setAjaxUrl(a.ajax_url);c.setIp(a.ip);c.setVersion(a.version);c.initCartTracking();f(document).ready(function(){c.syncCart()})}if(a.cart!==undefined){var e='<div id="'+a.tracking_element_selector+'" style="display:none;">'+JSON.stringify(a.cart)+"</div>";f(e).appendTo("body")}f("input#billing_email,input#billing_first_name,input#billing_last_name,input#billing_phone").on("change",function(){var j=f("#billing_phone").val();var g=f("#billing_email").val();var i=f("#ship-to-different-address-checkbox:checked").length;var h={billing_first_name:f("#billing_first_name").val(),billing_last_name:f("#billing_last_name").val(),billing_company:f("#billing_company").val(),billing_address_1:f("#billing_address_1").val(),billing_address_2:f("#billing_address_2").val(),billing_city:f("#billing_city").val(),billing_state:f("#billing_state").val(),billing_postcode:f("#billing_postcode").val(),billing_country:f("#billing_country").val(),billing_phone:f("#billing_phone").val(),billing_email:f("#billing_email").val(),ship_to_billing:i,order_notes:f("#order_comments").val(),shipping_first_name:f("#shipping_first_name").val(),shipping_last_name:f("#shipping_last_name").val(),shipping_company:f("#shipping_company").val(),shipping_address_1:f("#shipping_address_1").val(),shipping_address_2:f("#shipping_address_2").val(),shipping_city:f("#shipping_city").val(),shipping_state:f("#shipping_state").val(),shipping_postcode:f("#shipping_postcode").val(),shipping_country:f("#shipping_country").val(),action:"rnoc_track_user_data"};b(g,j,h)});f(".wp-block-woocommerce-checkout input#email,.wp-block-woocommerce-checkout input#phone").on("change",function(){var g=f(".wp-block-woocommerce-checkout input#email").val();var i=f(".wp-block-woocommerce-checkout input#phone").val();var h={billing_first_name:f(".wp-block-woocommerce-checkout #billing-first_name").val(),billing_last_name:f(".wp-block-woocommerce-checkout #billing-last_name").val(),billing_address_1:f(".wp-block-woocommerce-checkout #billing-address_1").val(),billing_address_2:f(".wp-block-woocommerce-checkout #billing-address_2").val(),billing_city:f(".wp-block-woocommerce-checkout #billing-city").val(),billing_postcode:f(".wp-block-woocommerce-checkout #billing-postcode").val(),billing_phone:i,billing_email:g,ship_to_billing:1,action:"rnoc_track_user_data"};b(g,i,h)});function b(g,l,i){var j=null;if(typeof g==="undefined"){return}var k=g.indexOf("@");var h=g.lastIndexOf(".");if(typeof l==="undefined"||l===null){l=""}if(!(k<1||h<k+2||h+2>=g.length)||l.length>=1){if(c.validateEmail(g)||l.length>=4){sessionStorage.setItem("rnocp_is_add_to_cart_popup_email_entered","1");f.ajax({url:a.ajax_url,headers:{},method:"POST",dataType:"json",data:i,async:true,success:function(m){if(m.success&&m.data){c.syncCart(m.data,true)}},error:function(m){j=m}})}else{sessionStorage.setItem("rnocp_is_add_to_cart_popup_email_entered","0")}}else{}}})};